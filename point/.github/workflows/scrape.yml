name: Hallym Notice Scraper

on:
  push:              # <--- 이 줄을 추가하세요! (저장하면 자동실행)
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:

jobs:
  scrape:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: 저장소 코드 가져오기
        uses: actions/checkout@v3

      - name: 파이썬 설정
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: 라이브러리 설치
        run: pip install requests beautifulsoup4 python-telegram-bot

      - name: 크롤링 실행
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: python main.py

      - name: 결과 저장 (강제 동기화 버전)
        run: |
          git config --global user.name 'NoticeBot'
          git config --global user.email 'bot@noreply.github.com'
          
          # [핵심 로직] 서버의 족보를 가져와서 내 족보를 강제로 맞춤
          git fetch origin main
          git reset origin/main
          
          # 이제 깨끗한 상태에서 파일을 다시 등록
          git add latest.txt
          
          # 변경사항이 있으면 저장하고 올림 (없으면 조용히 종료)
          git commit -m "Update latest notice" || exit 0
          git push origin main
 
